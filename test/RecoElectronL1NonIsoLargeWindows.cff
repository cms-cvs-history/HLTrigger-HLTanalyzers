############ initialize magnetic field #########################
include "MagneticField/Engine/data/volumeBasedMagneticField.cfi"

############### initialize geometry #####################
include "Geometry/CMSCommonData/data/cmsIdealGeometryXML.cfi"
include "Geometry/TrackerGeometryBuilder/data/trackerGeometry.cfi"
include "Geometry/TrackerNumberingBuilder/data/trackerNumberingGeometry.cfi"
include "RecoTracker/GeometryESProducer/data/TrackerRecoGeometryESProducer.cfi"

### ESProducers needed for tracking
include "RecoTracker/TransientTrackingRecHit/data/TransientTrackingRecHitBuilder.cfi"
include "TrackingTools/KalmanUpdators/data/KFUpdatorESProducer.cfi"

include "TrackingTools/TrackFitters/data/KFTrajectoryFitterESProducer.cfi"
include "TrackingTools/TrackFitters/data/KFTrajectorySmootherESProducer.cfi"
include "TrackingTools/TrackFitters/data/KFFittingSmootherESProducer.cfi" 

include "TrackingTools/MaterialEffects/data/MaterialPropagator.cfi"
include "TrackingTools/MaterialEffects/data/OppositeMaterialPropagator.cfi"
include "RecoLocalTracker/SiPixelRecHits/data/PixelCPEParmError.cfi"
include "RecoLocalTracker/SiStripRecHitConverter/data/StripCPEfromTrackAngle.cfi"
include "RecoLocalTracker/SiStripRecHitConverter/data/SiStripRecHitMatcher.cfi"
include "RecoTracker/CkfPattern/data/CkfTrajectoryBuilderESProducer.cff"

# modules to make seeds, tracks and electrons
include "RecoEgamma/EgammaElectronProducers/data/egammaChi2MeasurementEstimatorESProducer.cfi"
 module l1NonIsoElectronPixelSeedsLargeWindows = electronPixelSeeds from "RecoEgamma/EgammaElectronProducers/data/electronPixelSeeds.cfi"
replace l1NonIsoElectronPixelSeedsLargeWindows.ePhiMin1=-0.035
replace l1NonIsoElectronPixelSeedsLargeWindows.ePhiMax1=0.020
replace l1NonIsoElectronPixelSeedsLargeWindows.pPhiMin1=-0.035
replace l1NonIsoElectronPixelSeedsLargeWindows.pPhiMax1=0.020
replace l1NonIsoElectronPixelSeedsLargeWindows.pPhiMin2=-0.002
replace l1NonIsoElectronPixelSeedsLargeWindows.pPhiMax2=0.002
replace l1NonIsoElectronPixelSeedsLargeWindows.ZMin1=-15.0
replace l1NonIsoElectronPixelSeedsLargeWindows.ZMax1=15.0
replace l1NonIsoElectronPixelSeedsLargeWindows.ZMin2=-0.1
replace l1NonIsoElectronPixelSeedsLargeWindows.ZMax2=0.1

replace l1NonIsoElectronPixelSeedsLargeWindows.superClusterBarrelProducer = "correctedHybridSuperClustersL1NonIsolated"
#string superClusterBarrelLabel = ""
replace l1NonIsoElectronPixelSeedsLargeWindows.superClusterEndcapProducer = "correctedEndcapSuperClustersWithPreshowerL1NonIsolated"
#string superClusterEndcapLabel = ""

#TrajectoryBuilder
es_module TrajectoryBuilderForPixelMatchElectronsL1NonIsoLargeWindows = CkfTrajectoryBuilder from "RecoTracker/CkfPattern/data/CkfTrajectoryBuilderESProducer.cfi"

replace TrajectoryBuilderForPixelMatchElectronsL1NonIsoLargeWindows.ComponentName = "TrajectoryBuilderForPixelMatchElectronsL1NonIsoLargeWindows"

replace TrajectoryBuilderForPixelMatchElectronsL1NonIsoLargeWindows.estimator = "egammaChi2"

# CKFTrackCandidateMaker
#include "RecoTracker/CkfPattern/data/CkfTrackCandidates.cff"
module ckfL1NonIsoTrackCandidatesBarrelLargeWindows = ckfTrackCandidates from "RecoTracker/CkfPattern/data/CkfTrackCandidates.cfi"
replace ckfL1NonIsoTrackCandidatesBarrelLargeWindows.SeedProducer ="l1NonIsoElectronPixelSeedsLargeWindows"
replace ckfL1NonIsoTrackCandidatesBarrelLargeWindows.SeedLabel ="correctedHybridSuperClustersL1NonIsolated"

module ckfL1NonIsoTrackCandidatesEndcapLargeWindows = ckfTrackCandidates from "RecoTracker/CkfPattern/data/CkfTrackCandidates.cfi"
replace ckfL1NonIsoTrackCandidatesEndcapLargeWindows.SeedProducer ="l1NonIsoElectronPixelSeedsLargeWindows"
replace ckfL1NonIsoTrackCandidatesEndcapLargeWindows.SeedLabel ="correctedEndcapSuperClustersWithPreshowerL1NonIsolated"

# CTF track fit with material
#include "RecoTracker/TrackProducer/data/CTFFinalFitWithMaterial.cff"
module ctfL1NonIsoWithMaterialTracksBarrelLargeWindows = ctfWithMaterialTracks from "RecoTracker/TrackProducer/data/CTFFinalFitWithMaterial.cfi"
replace ctfL1NonIsoWithMaterialTracksBarrelLargeWindows.src = "ckfL1NonIsoTrackCandidatesBarrelLargeWindows"
module ctfL1NonIsoWithMaterialTracksEndcapLargeWindows = ctfWithMaterialTracks from "RecoTracker/TrackProducer/data/CTFFinalFitWithMaterial.cfi"
replace ctfL1NonIsoWithMaterialTracksEndcapLargeWindows.src = "ckfL1NonIsoTrackCandidatesEndcapLargeWindows"

#pixelMatchedElectrons
module pixelMatchElectronsL1NonIsoForHLTLargeWindows = pixelMatchElectronsForHLT from "RecoEgamma/EgammaHLTProducers/data/pixelMatchElectronsForHLT.cfi"

replace pixelMatchElectronsL1NonIsoForHLTLargeWindows.TrackBarrelLabel = "ctfL1NonIsoWithMaterialTracksBarrelLargeWindows"
#  string TrackBarrelProducer = ""
replace pixelMatchElectronsL1NonIsoForHLTLargeWindows.TrackEndcapLabel = "ctfL1NonIsoWithMaterialTracksEndcapLargeWindows"
#  string TrackEndcapProducer = ""
  replace pixelMatchElectronsL1NonIsoForHLTLargeWindows.SCLBarrelLabel            = "l1NonIsoElectronPixelSeedsLargeWindows"
  replace pixelMatchElectronsL1NonIsoForHLTLargeWindows.SCLBarrelProducer         = "correctedHybridSuperClustersL1NonIsolated"
  replace pixelMatchElectronsL1NonIsoForHLTLargeWindows.SCLEndcapLabel            = "l1NonIsoElectronPixelSeedsLargeWindows"
  replace pixelMatchElectronsL1NonIsoForHLTLargeWindows.SCLEndcapProducer         = "correctedEndcapSuperClustersWithPreshowerL1NonIsolated"
  replace pixelMatchElectronsL1NonIsoForHLTLargeWindows.TrajectoryBuilder    = "TrajectoryBuilderForPixelMatchElectronsL1NonIsoLargeWindows"

sequence pixelMatchElectronL1NonIsoLargeWindowSequenceForHLT = {l1NonIsoElectronPixelSeedsLargeWindows}

sequence pixelMatchElectronL1NonIsoLargeWindowTrackingSequenceForHLT = {
                                                     ckfL1NonIsoTrackCandidatesBarrelLargeWindows &
                                                     ckfL1NonIsoTrackCandidatesEndcapLargeWindows &
                                                     ctfL1NonIsoWithMaterialTracksBarrelLargeWindows &
                                                     ctfL1NonIsoWithMaterialTracksEndcapLargeWindows &
                                                     pixelMatchElectronsL1NonIsoForHLTLargeWindows
                                                     }


##------------------------------------------


  # RoadSearchCloudMaker
  include "RecoTracker/RoadSearchCloudMaker/data/RoadSearchClouds.cff"

  # RoadSearchCloudMaker
  include "RecoTracker/RoadSearchCloudCleaner/data/CleanRoadSearchClouds.cff"

  # RoadSearchTrackCandidateMaker
  include "RecoTracker/RoadSearchTrackCandidateMaker/data/RoadSearchTrackCandidates.cff"

  # RS track fit with material 
  include "RecoTracker/TrackProducer/data/RSFinalFitWithMaterial.cff"

module l1NonIsoElectronsRegionalPixelSeedGeneratorLargeWindows = hltEgammaRegionalPixelSeedGenerator from "RecoEgamma/EgammaHLTProducers/data/hltEgammaRegionalPixelSeedGenerator.cfi"

replace l1NonIsoElectronsRegionalPixelSeedGeneratorLargeWindows.candTag =  l1NonIsoRecoEcalCandidate
replace l1NonIsoElectronsRegionalPixelSeedGeneratorLargeWindows.candTagEle =  pixelMatchElectronsL1NonIsoForHLTLargeWindows
replace l1NonIsoElectronsRegionalPixelSeedGeneratorLargeWindows.UseZInVertex =  true
replace l1NonIsoElectronsRegionalPixelSeedGeneratorLargeWindows.originHalfLength = 0.5  

# TrackerTrajectoryBuilders
include "RecoTracker/CkfPattern/data/GroupedCkfTrajectoryBuilderESProducer.cff"

############### generate CTF track candidates ############

#include "RecoEgamma/EgammaHLTProducers/data/hltEgammaRegionalCkfTrackCandidates.cfi"
module  l1NonIsoElectronsRegionalCkfTrackCandidatesLargeWindows = hltEgammaRegionalCkfTrackCandidates from "RecoEgamma/EgammaHLTProducers/data/hltEgammaRegionalCkfTrackCandidates.cfi"
replace l1NonIsoElectronsRegionalCkfTrackCandidatesLargeWindows.SeedProducer = "l1NonIsoElectronsRegionalPixelSeedGeneratorLargeWindows"

# Chi2MeasurementEstimatorESProducer
include "TrackingTools/KalmanUpdators/data/Chi2MeasurementEstimatorESProducer.cfi"

# TrackProducer
module l1NonIsoElectronsRegionalCTFFinalFitWithMaterialLargeWindows = hltEgammaRegionalCTFFinalFitWithMaterial from "RecoEgamma/EgammaHLTProducers/data/hltEgammaRegionalCTFFinalFitWithMaterial.cfi"

replace l1NonIsoElectronsRegionalCTFFinalFitWithMaterialLargeWindows.src = "l1NonIsoElectronsRegionalCkfTrackCandidatesLargeWindows"

sequence l1NonIsoLargeWindowElectronsRegionalRecoTracker = {l1NonIsoElectronsRegionalPixelSeedGeneratorLargeWindows, l1NonIsoElectronsRegionalCkfTrackCandidatesLargeWindows, l1NonIsoElectronsRegionalCTFFinalFitWithMaterialLargeWindows} 

module l1NonIsoLargeWindowElectronTrackIsol  = hltElectronTrackIsol from "RecoEgamma/EgammaHLTProducers/data/hltElectronTrackIsol.cfi"

replace l1NonIsoLargeWindowElectronTrackIsol.electronProducer    = pixelMatchElectronsL1NonIsoForHLTLargeWindows
replace l1NonIsoLargeWindowElectronTrackIsol.trackProducer = l1NonIsoElectronsRegionalCTFFinalFitWithMaterialLargeWindows
